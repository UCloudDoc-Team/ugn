# 路由策略介绍

加入云联网的全部网络实例，路由会自动学习，无需手动配置。可以通过自定义创建路由策略，自定义管理实例间的互通关系。

- 默认策略：全部实例互通，优先级最低且不可修改
- 自定义策略：用户可以根据业务需求，配置不同的策略，可以增删改。

## 自定义策略内容

### 策略方向

路由策略按云联网对路由的收发，可以分别在接收方向和发送发送方向定义路由

- 接收方向：指云联网接受各个实例路由的方向，此方向仅需定位路由起点
- 发送方向：指云联网发送至各个实例路由的方向，此方向需要同时定位路由起点和终点

### 作用对象

 作用对象是指路由策略会应用的对象，可以批量多选。 

- 接收方向时，作用对象描述的是路由起点的特征，精确到一个网络实例的一个内网网段

  | 字段名称 | 地域             | 实例类型                                             | 实例ID                               | 地址前缀             |
  | -------- | ---------------- | ---------------------------------------------------- | ------------------------------------ | -------------------- |
  | 说明     | 选择对象所在地域 | 选择实例类型：VPC、Dedicate-VRouter（专线虚拟路由器）、Hynet-VRouter（托管虚拟路由器）、UWAN | 选择作为对象的网络实例资源ID，可多选 | 选择内网网段，可多选 |
  | 举例     | 上海             | VPC                                                  | XXX                                  | 192.168.0.0/16(XXX)  |

- 发送方向时，作用对象描述的是路由终点的特征，精确到网络实例

  | 字段名称 | 地域             | 实例类型                                             | 实例ID                               |
  | -------- | ---------------- | ---------------------------------------------------- | ------------------------------------ |
  | 说明     | 选择对象所在地域 | 选择实例类型<br />目前支持:VPC<br />其他类型敬请期待 | 选择作为对象的网络实例资源ID，可多选 |
  | 举例     | 上海             | VPC                                                  | XXX                                  |

###  路由匹配条件

路由匹配条件是指云联网发送方向时，选择路由的条件集合，描述的是路由起点的特征，可以批量多选。

可以精确至网络实例，或者精确至网络实例的内网网段

| 字段名称 | 地域                     | 实例类型                                             | 实例ID                               | 地址前缀             |
| -------- | ------------------------ | ---------------------------------------------------- | ------------------------------------ | -------------------- |
| 说明     | 非必选，选择对象所在地域 |  选择实例类型：VPC、Dedicate-VRouter（专线虚拟路由器）、Hynet-VRouter（托管虚拟路由器）、UWAN  | 选择作为对象的网络实例资源ID，可多选 | 选择内网网段，可多选 |
| 举例     | 上海                     | VPC                                                  | XXX                                  | 192.168.0.0/16(XXX)  |

### 执行动作

执行动作表示，经过作用对象和路由匹配条件定位的路由，云联网对他执行放行和拒绝的行为。

- **允许**：路由正常收发
- **拒绝：**路由丢弃

###  路由优先级

路由优先级代表路由转发的先后顺序，优先级高的先被转发。

仅执行动作为允许时可以设置，范围是1-255，数字越小代表优先级越高。

### 基础配置

**策略名称**

设置策略名称用于标识内容

**策略优先级**

策略优先级代表匹配的顺序，优先级高的先被扫描匹配

同一个云联网实例内，同方向的策略优先级唯一不可重复，范围1-255

## 策略执行流程

1. 云联网收到某网络实例的路由，判断路由方向和路由内容，并按策略优先级由高到低尝试匹配

- 匹配策略方向：接收方向和发送方向分别匹配
- 匹配作用对象：命中与策略内作用对象一致的策略
- 匹配路由：命中与策略内路由匹配条件一致的策略

2. 符合全部条件则进入下一步，任一条件不符合则匹配下一条，以此类推。如果一直无法匹配，则按照默认全部互通的策略执行

3. 执行策略内容。分为允许和拒绝，如果行为是允许，根据路由优先级由高到低转发路由

- 接收方向：允许则该路由可以成功上传到云联网内，拒绝则该路由不会通过云联网发给任何实例
- 发送方向：允许则该路可以下发给作用对象，拒绝则该路由不会发送给作用对象

4. 执行完毕。无论策略内容是什么，策略执行后，云联网就会结束匹配动作，生成单云联网实例唯一生效路由表。

## 路由表

云联网的路由表，用于展示单云联网实例内的路由情况，策略生效后可在此处核实。详见[路由表](https://docs.ucloud.cn/ugn/guide/flow/flow_map)

